# 改善・追加設計案
## 1. ウィザード/設定エディタ：「途中保存」「やり直し」導線
### UI要素提案
- 各ステップ右下：
`[←戻る] [一時保存] [リセット] [→次へ]`
    - 「一時保存」…現時点の入力内容を一時ファイル等へ保存
    - 「リセット」…現在ステップの値 or ウィザード全体の入力値を初期化（要確認ダイアログ）

### イベント設計
- `一時保存ボタン押下` → 入力値検証後に一時保存し、トーストで反映
- `リセットボタン押下` → 現在の未保存値破棄（ダイアログで要確認）
- ステップ戻りは入力値を保持したままシームレスに戻れる設計（バリデーション結果も記録）

## 2. 設定ファイル バリデーションエラー時の詳細表示
### UI要素提案
- エラーバナー：
`「保存に失敗しました：APIキーを入力してください」「Blueskyハンドル形式が不正です」`
- 各入力欄横に`errorText`を明示

### イベント設計
- 「保存」時、入力バリデーション実行→エラー時は
    - 該当フォーム（`TextField`, `Radio`, `Dropdown`等）に明示的なエラーメッセージを表示
    - エラー一覧（ダイアログ or 画面上部のまとめバナー）で全体通知

## 3. APIキーやパスワード欄の「表示/非表示」「コピー」機能
### UI要素提案
- API欄の末尾に`[👁][コピー]`アイコンボタン
- 「👁」で値の表示/隠蔽トグル
- 「コピー」で値をクリップボード

### イベント設計
- 「👁」押下で`obscureText`切替
- 「コピー」押下でクリップボード＋トースト通知`「コピーしました」`

## 4. 状態表示の自動リフレッシュ
### 実装方式
- Fletの`Timer`や非同期更新・WebSocketで5秒毎程度のポーリング
- サーバー・トンネルの状態/外部URL/ログが自動更新
- 手動「リロード」ボタンも設置

### UI表現
- 状態欄右上に「最後更新日時」
- タイマーアニメ、または「ライブ」ピル（バッジ）表記

## 5. エラー時のリカバリ導線
### UI要素提案
- エラー通知に `[再試行] [詳細ログ]` ボタン
- 詳細ログはダイアログまたは別画面で表示（コピーボタン付）

### イベント設計
- 「再試行」→ 直前操作を復帰（リトライ）
- 「詳細ログ」→ 通信エラーなど場合によって詳細情報・スタックを別途表示

## 6. アクセシビリティ・多言語対応
### 改善点
- 画面上部に `[日本語/English切替]`　 セレクター
- ボタン／入力欄にはaltラベル（ツールチップ）やキーボードアクセスkey
- 色覚対応・コントラストチェック

## 7. 設定のインポート/エクスポート導線
### UI要素提案
- メイン画面上部、またはプロファイル切替横に
`[インポート][エクスポート]` ボタン
- ファイルダイアログで`.json`/`.yaml`ファイル指定

### イベント設計
- 「エクスポート」：現在の設定情報を書き出し
- 「インポート」：ファイル読込→バリデ結果がOKなら即時反映。不正時はエラーメッセージ

# 【追加ダイアログ・UIモック例】
``` plaintext
+--------------------------------------------------------+
| 保存エラー： 2件                                    [×]|
| ・APIキーが未入力                                      |
| ・通知テンプレ内 変数名が不正                          |
| [OK] [問題の箇所を表示]                                |
+--------------------------------------------------------+

+--------------------------------------------------------+
|     [APIキー] ************** [👁][コピー]               |
+--------------------------------------------------------+
```


# StreamNotifyonBluesky Flet新GUI 仕様設計書（改訂版）
## 1. ウィザード画面
### 1-1. 主なUI要素・レイアウト

| 要素名 | コントロール | プロパティ例 / 説明 |
| --- | --- | --- |
| ステップ表示 | ProgressBar | value: 現在のステップ数/全体数 |
| サービス選択群 | Checkbox | Twitch/YouTube/Niconico |
| APIキー欄 | TextField + Icons | type=password, [表示/非表示切替👁], [コピー📋] |
| Blueskyアカウント欄 | TextField | 必須, 形式バリデーション |
| 通知テンプレート欄 | TextArea | multi-line, placeholder |
| トンネル方式選択 | RadioButtons | Cloudflare/ngrok/localtunnel/カスタム |
| 次へ/戻る/完了 | Button | disabled制御 |
| 一時保存ボタン | Button | 現在の入力を一時保存 |
| リセットボタン | Button | 現在ステップ、または全体入力をリセット |
| 入力/バリデーションエラー | Banner/Text | errorTextとして各フィールド下/画面上部に明示 |
#### ワイヤーフレーム例
``` plaintext
┌──────────── ウィザード (1/5) ──────────────┐
| [✓] Twitch  [✓] YouTube  [ ] Niconico          |
| APIキー [**************] [👁][📋] 必須        |
| ハンドル [name@bsky.social]                   |
| 通知テンプレ：                                 |
| ┌──────────────────────┐                  |
| |【title】が配信開始！                  |   |
| └──────────────────────┘                  |
| [←戻る] [リセット] [一時保存] [→次へ]         |
| (エラーバナー)                                |
└────────────────────────────────────┘
```
### 1-2. イベント設計一覧

| イベント名 | 発生箇所 | 内容・アクション |
| --- | --- | --- |
| サービス選択変更 | Checkbox | 必須API欄の追加/削除 切替 |
| 入力値変更 | TextField等 | バリデ実施、エラー表示、進行可否制御 |
| 「一時保存」 | Button | 入力値を一時ファイルに書き出し トースト通知 |
| 「リセット」 | Button | 現在または全体初期化（要確認ダイアログ） |
| 「表示/非表示」 | IconButton | パスワード欄の非表示/表示切替 |
| 「コピー」 | IconButton | クリップボード格納＋トースト |
| 「次へ」「戻る」 | Button | エラーチェック, ステップ遷移 |
| 「完了」 | Button | 設定保存・ウィザード終了 |
| 入力エラー時 | 各所 | 該当欄にerrorText/全体エラーバナー |
## 2. メイン設定・管理画面
### 2-1. 主なUI要素・レイアウト

| 要素名 | コントロール | プロパティ例 / 説明 |
| --- | --- | --- |
| 設定エディタ（一般項目） | フォーム/TextField | 必須・バリデ、変更検知 |
| 詳細エディタ | TextArea | 高度ユーザ向け設定 json編集 |
| 設定保存・適用 | Button | 編集済みでのみenabled |
| サーバー起動/停止 | SwitchButton/Button | 状態・エラー時色変更 |
| トンネル起動/停止 | Button | 外部URL付, 状態 |
| 状態自動更新/リロード | Timer+Button | 5秒ご自動更新＋手動リロード |
| 最終更新ラベル | Text | 「最終更新: HH:MM:SS」 |
| 状態表示バー | Row/Column | サーバー/トンネル: 稼働バッジ, URL, ライブピル |
| 通知ログリスト | ListView | 日時・サービス・内容・成功/失敗バッジ |
| エラー通知 | Banner/Dialog | 詳細情報、再試行/詳細ログボタン付 |
| プロファイル切替 | Dropdown | 各設定プロファイル選択 |
| プロファイル新規・削除 | Button | ダイアログ付 |
| インポート/エクスポート | Button | .json/.yaml 読込/書込 |
| 言語切替 | Switch/Dropdown | 日本語・英語の切替 |
### 2-2. イベント設計一覧

| イベント名 | 発生箇所 | 内容・アクション |
| --- | --- | --- |
| 各設定値変更 | 各TextField等 | バリデ、未保存状態警告 |
| 設定保存 | 保存ボタン | バリデ・保存、成功/失敗トースト |
| サーバー/トンネル起動・停止 | Button | 状態切替、エラー表示・再試行 |
| 自動/手動リフレッシュ | タイマー/ボタン | サーバー/トンネル/ログ自動更新 |
| 詳細ログ表示 | エラーモーダル等 | ポップアップで失敗時原因・ログを表示 |
| プロファイル切替 | Dropdown | 設定ロード・反映 |
| プロファイル新規/削除 | Button | 新規名ダイアログ・削除確認 |
| インポート/エクスポート | Button | ファイル選択→バリデ→保存/反映。「成否でトースト表示」 |
| 言語切替 | Switch/Dropdown | 画面内文言をリアルタイム切替 |
### 2-3. ワイヤーフレーム例
``` plaintext
┌───────── StreamNotifyonBluesky ──────────┐
| 設定エディタ           [保存][インポート][エクスポート]   |
| [Twitch ClientID   ][********] [👁][📋]    |
| [Bluesky Handle    ][_______]             |
| [通知テンプレ]    ┌──────────────┐         |
|                  |〜             |         |
|                  └──────────────┘         |
| [ サーバー:●稼働 ][トンネル:□停止][ライブ][更新 21:30] |
| [ サーバー停止/起動 ][トンネルURL][コピー][リロード]  |
| 通知ログ（即時自動更新）                      |
|2025/05/30 21:30 Twitch 配信検知→通知済      |
|2025/05/30 21:00 YouTube 新着→通知失敗 [再試行][詳細]|
| プロファイル: [default▼][＋新規][－削除]     |
| 言語: [日本語/English切替]                  |
└────────────────────────────────────────┘
```
## 3. 補足・ベストプラクティス
- **フォームバリデーション：** 各欄ごとにerrorText明示、保存時もエラー箇所・内容一覧表示
- **パスワード・APIキー管理：** [👁][📋]で表示/コピー明示的に。
- **自動更新：** TimerまたはWebSocket等方式を設計に明記（実装実現性に合わせ選択）
- **リカバリ導線：** エラー時、[再試行][詳細]両方ポップアップ/バナーでUX向上
- **リセット・一時保存：** ウィザード/エディタの入力途中で保留や取り消しが可能
- **多言語・アクセシビリティ：** i18n設計、ツールチップ・アクセスキー、コントラスト配慮
- **設定のインポート/エクスポート：** JSON/YAML対応、反映前バリデ警告あり

### 追加UIダイアログ例
``` plaintext
保存失敗：入力エラー(2件)
----------------------------------------
・Blueskyハンドル欄が空です
・APIキー欄が不正長
[OK] [問題箇所へジャンプ]

APIキー [**********] [👁][📋]
```

